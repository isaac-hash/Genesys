from launch import LaunchDescription
from launch_ros.actions import Node
from launch.substitutions import LaunchConfiguration
from ament_index_python.packages import get_package_share_directory
import os

def generate_launch_description():
    pkg_share = get_package_share_directory('{{ package_name }}')
    robot_name = LaunchConfiguration('robot_name', default='{{ robot_name }}')
    namespace = LaunchConfiguration('namespace', default='')
    x = LaunchConfiguration('x', default='0.0')
    y = LaunchConfiguration('y', default='0.0')
    z = LaunchConfiguration('z', default='0.1')

    # URDF file (use .urdf if .xacro is not available)
    urdf_base = os.path.join(pkg_share, 'urdf', '{{ robot_name }}')
    urdf_file = urdf_base + '.urdf'
    if not os.path.exists(urdf_file):
        urdf_file = urdf_base + '.urdf.xacro'

    # For Gazebo Sim (Ignition), use the spawn_entity.py script
    spawn_node = Node(
        package='ros_gz_sim',
        executable='create',
        arguments=[
            '-name', robot_name,
            '-file', urdf_file,
            '-x', x,
            '-y', y,
            '-z', z
        ],
        output='screen'
    )

    return LaunchDescription([spawn_node])