
import asyncio
from genesys.decorators import node, action_server
from genesys.helpers import spin_node
from action_tutorials_interfaces.action import Fibonacci

@node("{{ node_name }}")
class {{ class_name }}:
    """
    A simple action server node.
    This node is auto-generated by the Genesys framework.
    """
    def __init__(self):
        self.logger.info("Action server is ready to handle goals.")

    @action_server(action_name="fibonacci", action_type=Fibonacci)
    async def fibonacci_execute_callback(self, goal_handle):
        """Executes the Fibonacci action goal."""
        self.logger.info('Executing goal...')

        feedback_msg = Fibonacci.Feedback()
        sequence = [0, 1]
        
        for i in range(1, goal_handle.request.order):
            if goal_handle.is_cancel_requested:
                goal_handle.canceled()
                self.logger.info('Goal canceled')
                return Fibonacci.Result()

            sequence.append(sequence[i] + sequence[i-1])
            feedback_msg.partial_sequence = sequence
            {% raw %}
            self.logger.info(f'Feedback: {feedback_msg.partial_sequence}')
            {% endraw %}

            goal_handle.publish_feedback(feedback_msg)
            await asyncio.sleep(1)

        goal_handle.succeed()

        result = Fibonacci.Result()
        result.sequence = sequence
        {% raw %}
        self.logger.info(f'Returning result: {result.sequence}')
        {% endraw %}

        return result
