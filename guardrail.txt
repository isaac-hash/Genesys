{
  "feature": "Persistent Workspace Sourcing",
  "description": "Ensures that after building a Genesys workspace, the environment setup is automatically sourced in all future shells, eliminating the need for manual sourcing after each new terminal session.",
  "scope": {
    "applies_to": ["genesys build command"],
    "languages_supported": ["C++ (ament_cmake)", "Python (ament_python)"],
    "shells_supported": ["bash", "zsh"]
  },
  "design": {
    "default_behavior": "genesys build only sources in the temporary shell used for the build process. The sourcing does not persist in new shells.",
    "enhanced_behavior": "With the --persist flag, Genesys CLI appends the workspace setup sourcing to the user’s shell initialization file (~/.bashrc or ~/.zshrc).",
    "implementation": {
      "files_modified": ["~/.bashrc", "~/.zshrc"],
      "line_added": "source <workspace_path>/install/setup.bash",
      "condition": "Only added if not already present"
    }
  },
  "user_experience": {
    "command": "genesys build --persist",
    "feedback": [
      "✓ Build completed successfully.",
      "✓ Workspace sourcing added to ~/.bashrc",
      "Open a new terminal to use the updated environment."
    ],
    "rollback": "User can manually remove the sourcing line from ~/.bashrc if undesired."
  },
  "guardrails": {
    "idempotency": "Ensure the sourcing line is only added once per workspace.",
    "safety": "Never overwrite existing .bashrc/.zshrc contents. Only append a new line.",
    "portability": "Detect user’s shell (bash/zsh) and update the appropriate file.",
    "opt_in": "Persistent sourcing must only occur when --persist is explicitly passed."
  },
  "risks": {
    "misconfiguration": "Appending the wrong path could break shell startup. Mitigate by checking if <workspace_path>/install/setup.bash exists before appending.",
    "user_confusion": "If multiple workspaces exist, only the last one added to .bashrc will be active unless user manages sourcing manually."
  }
}
